/*! YAMVC v0.1.11 - 2014-01-27 
 *  License:  */
(function(t){"use strict";var e,n=t.yamvc||{},r=n.mixins||{};e={set:function(t,e){var n="_"+t,r=this[n];return e!==r&&(this[n]=e,this.fireEvent(t+"Change",this,e,r)),this},get:function(t){return this["_"+t]}},r.GetSet=e,t.yamvc=n,t.yamvc.mixins=r})(window),function(t){"use strict";var e,n=t.yamvc||{},r=n.mixins||{};e={init:function(){this.set("listeners",{}),this.set("suspendEvents",!1)},fireEvent:function(){if(this._suspendEvents)return!0;for(var t=!0,e=Array.prototype.shift,n=e.call(arguments),r=0,i=this._listeners[n]||[],a=i.length;a>r;r++)if(t){var o=e.call(arguments);t=i[r].apply(o,arguments),t=t===undefined?!0:t}return t},addListener:function(t,e){var n=this._listeners[t]||[];return n.push(e),this._listeners[t]=n,this},removeListener:function(t,e){var n,r=this._listeners;if(r)if(e){if("function"==typeof e)for(var i=0,a=r.length;a>i;i++)r[i]===e&&(n=i);else n=e;r.splice(n,1)}else this._listeners=[];return this},suspendEvents:function(t){return t=t||!0,this.set("suspendEvents",t),this}},r.Observable=e,t.yamvc=n,t.yamvc.mixins=r}(window),function(t){"use strict";function e(){for(var t=0,e=a.length;e>t;t++)a[t]()}var n,r,i=t.yamvc||{},a=[];i.$onReady=function(t){a.push(t),r||"complete"===document.readyState||(r=setInterval(function(){"complete"===document.readyState&&(clearInterval(r),e())},10))},i.$merge=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},i.$clone=function(t){return JSON.parse(JSON.stringify(t))},n=i.Core||function(){function t(){this.set("listeners",{}),this.bindMethods.apply(this,arguments),this.init.apply(this,arguments)}return t.prototype.init=function(){},t.prototype.initConfig=function(){var t,e,n,r=this,i=r.get("config"),a=function(n){t="get"+n.charAt(0).toUpperCase()+n.slice(1),e="set"+n.charAt(0).toUpperCase()+n.slice(1),r[t]=function(){return r.get("config")[n]},r[e]=function(t){var e=r.get("config")[n];t!==e&&(r.get("config")[n]=t,r.fireEvent(n+"Change",this,t,e))}};for(n in i)i.hasOwnProperty(n)&&a(n)},t.prototype.bindMethods=function(t){for(var e in t)t.hasOwnProperty(e)&&"function"==typeof t[e]&&(this[e]=t[e].bind(this),delete t[e])},t.prototype.onChange=function(t,e){return this.addListener(t+"Change",e),this},t.prototype.unbindOnChange=function(t,e){for(var n=this._listeners[t+"Change"]||[],r=0,i=n.length;i>r;r++)n[r]===e&&n.splice(r,1);return this._listeners[t+"Change"]=n,this},t.$mixin=function(t,e){var n,r;e?n="function"==typeof t?t.prototype:t:(e="function"==typeof t?t.prototype:t,n=this.prototype);for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r])},t.__mixins__=[],t.__defaults__={},t.$extend=function(e){e=e||{};var n=this,r=function(){var e;this._config={};for(e in a)c.call(a,e)&&(this._config[e]=a[e]);t.apply(this,arguments)},a=i.$merge(e.defaults||{},n.__defaults__),o=e.mixins||[],s=e.static||{},c={}.hasOwnProperty,u=function(n,r){function i(){this.constructor=n}for(var u in r)c.call(r,u)&&(n[u]=r[u]);i.prototype=r.prototype,n.Parent=r.prototype,n.prototype=new i,n.$extend=t.$extend,n.$mixin=t.$mixin,n.__mixins__=[],n.__defaults__=a;for(var l in e)c.call(e,l)&&"function"==typeof e[l]&&(n.prototype[l]=e[l]);for(;o.length;)n.mixin(o.pop());for(var d in s)c.call(s,d)&&(n["$"+d]=s[d]);return n};return u(r,n),r},t.$mixin(i.mixins.GetSet),t.$mixin(i.mixins.Observable),t}(),i.Core=n,t.yamvc=i}(window),function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.$extend({defaults:{proxy:null},init:function(t){e.Parent.init.apply(this,arguments);var r,i=this;return t=t||{},r=n.$merge(i._config,t.config),i.set("initOpts",t),i.set("config",r),i.set("set",[]),i.set("cache",[]),i.set("removed",[]),i.set("filters",[]),i.initConfig(),i.initData(),i},initData:function(){var t=this,e=t.getData()||[];return t.set("raw",e),t.prepareData(e),t},add:function(t){var e,n=this,r=n.getModel(),i=n.getModelConfig().namespace;for(Array.isArray(t)||(t=[t]);t.length;)e=t.pop(),e=new r({config:{namespace:i,data:e}}),n._cache.push(e),n.fireEvent("cacheChanged");return n.filter(),n},count:function(){return this._set.length},clear:function(){var t=this;return t.set("set",[]),t.set("cache",[]),t.set("removed",[]),t},clearFilters:function(){var t=this;return t.set("filters",[]),t.filter(),t},filter:function(t){var e,n=this,r=n._filters,i=!0,a=[],o=n._cache,s=0;"function"==typeof t&&(r.push(t),n.fireEvent("filtersChanged"));for(var c=0,u=o.length;u>c;c++){for(i=!0,s=r.length;s--;)e=r[s],i=i&&e(o[c]);i&&a.push(o[c])}return n.set("set",a),n},getAt:function(t){return this._set[t]},getBy:function(t){for(var e=this,n=e._set,r=[],i=0,a=n.length;a>i;i++)t(n[i])&&r.push(n[i]);return r},getOneBy:function(t){for(var e,n=this,r=n._set,i=r.length;i--;)if(t(r[i])){e=r[i];break}return e},getTotal:function(){return this._total},load:function(t){var e,r,i=this,a=(i.get("data"),i.get("idProperty"),n.Promise.$deferred()),o=i.getModelConfig().namespace,s=new n.data.Action,c=0;for(r in t)c++;if(0===c)throw Error("You need to pass at least one condition to load model collection");if(!i.getProxy())throw Error("To load collection you need to set proxy");return e=function(){"success"===i.getProxy().getStatus()?i.fireEvent("loaded",i,s.getResponse(),"read"):i.fireEvent("error",i,"read")},s.setOptions({callback:e,params:t,namespace:o}),i.getProxy().read(s),a.promise},save:function(){for(var t,e,r,i,a=this,o=n.Promise.$deferred(),s=[],c=[],u=a._removed,l=a._cache,d=a.getModelConfig(),f=d.namespace,h=a.getProxy(),p=0,g=[],v=0,y=l.length;y>v;v++)r=l[v],r._isDirty&&(r.hasId()?c.push(r._data):(r._data.__clientId__=r.get("clientId"),s.push(r._data)));return i=function(t){return function(e){return t.__clientId__?e.data("__clientId__")===t.__clientId__:e.data("id")===t.id}},e=function(t,e){if(p--,e.getStatus()===n.data.Action.Status.SUCCESS){var s,c=e.getResponse(),u=c.result;if(r=u[0],s=u.length,r&&(r.__clientId__||r.id))for(;s--;)r=a.getOneBy(i(u[s])),r.setDirty(!1),delete r._data.__clientId__;else a.set("removed",[])}else g.push(e.getResponse().error);0===p&&(g.length?(a.fireEvent("error",a,g),o.reject({errors:g})):(a.fireEvent("success",a),o.resolve({scope:a})))},s.length&&(p++,t=new n.data.Action,t.setOptions({namespace:f,callback:e}).setData(s),h.create(t)),c.length&&(p++,t=new n.data.Action,t.setOptions({namespace:f,callback:e}).setData(c),h.update(t)),u.length&&(p++,t=new n.data.Action,t.setOptions({namespace:f,callback:e}).setData(u),h.destroy(t)),o.promise},prepareData:function(t,e){var n=this,r=n.getModel(),i=n.getModelConfig?n.getModelConfig():{},a=t.length,o=[];e=e||a;for(var s=0;a>s;s++)i.data=t[s],o.push(new r({data:t[s],config:i}));return n.set("cache",o),n.set("total",e),n.filter(),n},setData:function(){var t=this;return t.setRawData(data),t.prepareData(data),t},getData:function(){return this._set},getRawData:function(){return this._raw},setRawData:function(t){return this.set("raw",t),this},isDirty:function(){for(var t=this._cache,e=t.length,n=!1;e--;)t[e]._isDirty&&(n=!0);return this._remove&&(n=!0),n}}),t.yamvc=n,t.yamvc.Collection=e}(window),function(t){"use strict";var e,n,r=t.yamvc||{};e=r.Core.$extend({init:function(t){var e,i=this;return t=t||{},e=t.config||{},n=n||new r.Router,i.set("initOpts",t),i.set("config",e),i.set("routes",e.routes||{}),i.set("events",e.events||{}),i.set("views",e.views||{}),i.initConfig(),i.renderViews(),i.restoreRouter(),i},initConfig:function(){r.Core.prototype.initConfig.apply(this);var t,e,i=this,a=i.get("routes"),o=i.get("events"),s=i.get("views"),c=/(^\$|,$)/;if(a)for(var u in a)if(a.hasOwnProperty(u)){var l=i[a[u]].bind(i);n.when(u,l)}if(o&&s){for(e in s)s.hasOwnProperty(e)&&s[e].addListener("render",i.resolveEvents.bind(i));for(t in o)if(o.hasOwnProperty(t)&&c.test(t)){if(e=s[t.substr(1)])for(var d in o[t])o[t].hasOwnProperty(d)&&e.addListener(d,o[t][d].bind(i,e));delete o[t]}}return this},renderViews:function(){var t=this,e=t.get("views");for(var n in e)e.hasOwnProperty(n)&&e[n].getAutoCreate&&e[n].getAutoCreate()&&e[n].render()},resolveEvents:function(t){var e,n,r,i=this.get("events"),a=function(t,e,n){return t.bind(e,n)};for(var o in i)if(i.hasOwnProperty(o)){e=i[o],n=t.get("el").querySelectorAll(o);for(var s=0,c=n.length;c>s;s++)for(var u in e)e.hasOwnProperty(u)&&(r=a(e[u],this,t),n[s].addEventListener(u,r))}},getRouter:function(){return n},restoreRouter:function(){var t=this;return t.getRouter().restore(),t},redirectTo:function(e){return t.location.hash=e,this}}),t.yamvc.Controller=e}(window),function(t){"use strict";var e,n,r=t.yamvc||{};n={PENDING:0,SUCCESS:1,FAIL:2},e=r.Core.$extend({init:function(t){var i,a=this;e.Parent.init.apply(this,arguments),t=t||{},i=r.$merge(a._config,t.config),a.set("initOpts",t),a.set("config",i),a.set("response",{}),a.set("status",n.PENDING),a.initConfig()},setData:function(t){return this.set("data",t),this},getData:function(){return this._data},setOptions:function(t){return this.set("options",t),this},getOptions:function(){return this._options},getOption:function(t){return this._options[t]},setResponse:function(t){return this.set("response",t)},getResponse:function(){return this.get("response")},setStatus:function(t){var e,r=!1;for(e in n)n.hasOwnProperty(e)&&n[e]===t&&(r=!0);if(!r)throw Error("yamvc.data.Action: Wrong status");return this.set("status",t)},getStatus:function(){return this.get("status")}}),e.Status=n,t.yamvc=r,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.Action=e}(window),function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.$extend({init:function(t){var r,i=this;e.Parent.init.apply(this,arguments),t=t||{},r=n.$merge(i._config,t.config),i.set("initOpts",t),i.set("config",r),i.initConfig()},read:function(t){var e,r,i=this;if(!(t instanceof n.data.Action))throw Error("yamvc.data.Proxy: read argument action should be instance of yamvc.data.Action");if(e=t.getOptions(),r=e.params&&e.params.id,!t.getOption("namespace"))throw Error("yamvc.data.Proxy: namespace should be set");return r===undefined?i.readBy(t):i.readById(t),i},create:function(t){var e=this;if(!(t instanceof n.data.Action))throw Error("yamvc.data.Proxy: create argument action should be instance of yamvc.data.Action");if(!t.getOption("namespace"))throw Error("yamvc.data.Proxy: namespace should be set");if(!t.getData()||"object"!=typeof t.getData())throw Error("yamvc.data.Proxy: Data should be object");return e},update:function(t){var e=this;if(!(t instanceof n.data.Action))throw Error("yamvc.data.Proxy: update argument action should be instance of yamvc.data.Action");if(!t.getOption("namespace"))throw Error("yamvc.data.Proxy: namespace should be set");if(!t.getData()||"object"!=typeof t.getData())throw Error("yamvc.data.Proxy: Data should be object");return e},destroy:function(t){var e=this;if(!(t instanceof n.data.Action))throw Error("yamvc.data.Proxy: destroy argument action should be instance of yamvc.data.Action");if(!t.getOption("namespace"))throw Error("yamvc.data.Proxy: namespace should be set");if(!t.getData()||"object"!=typeof t.getData())throw Error("Data should be pass as object");return e}}),t.yamvc=n,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.Proxy=e}(window),function(t){"use strict";var e,n=t.yamvc||{},r=n.data.Proxy,i=n.data.Action;e=r.$extend({"static":{clear:function(t){var e,n=0;if(t)for(Array.isArray(t)||(t=[t]),n=t.length;n--;)e=t[n],delete localStorage[e],delete localStorage[e+"$Sequence"];else for(var r in localStorage)delete localStorage[r],delete localStorage[r+"$Sequence"]}},readBy:function(t){var e,r,i,a,o,s,c,u=this,l=t.getOptions(),d=l.namespace,f=l.callback,h=l.limit||null,p=l.offset||0,g=l.filters||[],v=l.sorters||[],y={},m=[],C=[],_=!0,E=0;return o=function(t,e){var n=""+t[i],r=""+e[i],a=n.toLowerCase(),o=r.toLowerCase();return(a>o?1:o>a?-1:n>r?1:r>n?-1:0)*("desc"===s.toLowerCase()?-1:1)},e=function(){if(localStorage[d]){C=JSON.parse(localStorage[d]);for(var e=0,l=C.length;l>e;e++){for(_=!0,c=g.length;c--;)r=g[c].length>3?g[c][0]:"&&","&&"===r?_=u.executeCondition(C[e],g[c])&&_:"||"===r&&(_=u.executeCondition(C[e],g[c])||_);_&&m.push(C[e])}for(C=m,E=m.length,c=v.length;c--;)a=v[c],i=a[0],s=a[1]||"ASC",C.sort(o);h||(h=C.length-p),(p>0||h)&&(C=C.splice(p,h))}y.total=E,y.result=C,t.setStatus(n.data.Action.Status.SUCCESS).setResponse(y),f(u,t)},setTimeout(function(){try{e()}catch(n){y.error=n,f(u,t)}},0),u},readById:function(t){var e,r=this,i=t.getOptions(),a=i.params,o=i.namespace,s=i.callback,c=a.id,u=[],l={},d={};return e=function(){if(localStorage[o]){u=JSON.parse(localStorage[o]);for(var e=0,i=u.length;i>e;e++)u[e].id===c&&(l=u[e]);if(l.id!==undefined)return d.total=1,d.result=l,t.setStatus(n.data.Action.Status.SUCCESS).setResponse(d),s(r,t),r}r.setStatus(n.data.Action.Status.FAIL),d.error=Error("Not found"),s(r,t)},setTimeout(e,0),r},executeCondition:function(t,e){var n,r,i,a,o=!1;switch(e.length>3?(r=e[1],n=e[2],i=e[3]):(r=e[0],n=e[1],i=e[2]),n){case">":t[r]>i&&(o=!0);break;case"<":i>t[r]&&(o=!0);break;case">=":t[r]>=i&&(o=!0);break;case"<=":i>=t[r]&&(o=!0);break;case"like":"%"!==i.charAt(0)&&(i="^"+i),"%"!==i.charAt(i.length-1)&&(i+="$"),i=i.replace(/%/g,""),a=RegExp(i),a.test(t[r])&&(o=!0)}return o},create:function(t){var n,r,a=this,o=t.getData(),s=t.getOption("namespace"),c=t.getOption("callback"),u=[],l=1,d={};if(e.Parent.create.apply(this,arguments),localStorage[s]&&(u=JSON.parse(localStorage[s]),l=localStorage[s+"$Sequence"]),Array.isArray(o)){n=[];for(var f=0,h=o.length;h>f;f++)o[f].id=l++,delete o[f].__clientId__,u.push(o[f]),n.push(o[f])}else o.id=l++,delete o.__clientId__,u.push(o),n=o;return r=function(){try{localStorage[s]=JSON.stringify(u),localStorage[s+"$Sequence"]=l,d.result=n,t.setStatus(i.Status.SUCCESS).setResponse(d)}catch(e){d.error=e,t.setStatus(i.Status.FAIL).setResponse(d)}c(a,t)},setTimeout(r,0),a},update:function(t){var e,n,r,a,o,s=this,c=t.getData(),u=t.getOption("namespace"),l=t.getOption("callback"),d=[],f={};return o=function(){if(localStorage[u]){if(d=JSON.parse(localStorage[u]),Array.isArray(c))for(e=[],r=c.length;r--;)for(a=d.length,n=c[r].id;a--;)d[a].id===n&&(d[a]=c[r],e.splice(0,0,c[r]));else for(r=d.length,n=c.id;r--;)d[r].id===n&&(e=d[r]=c);try{localStorage[u]=JSON.stringify(d),f.success=!0,f.result=e,t.setStatus(i.Status.SUCCESS).setResponse(f)}catch(o){f.success=!1,f.error=o,t.setStatus(i.Status.FAIL).setResponse(f)}return l(s,t),s}f.success=!1,f.error=Error("Not found"),t.setStatus(i.Status.FAIL).setResponse(f),l(s,t)},setTimeout(o,0),s},destroy:function(t){var e,n,r,a,o=this,s=t.getData(),c=t.getOption("namespace"),u=t.getOption("callback"),l=[],d={};return a=function(){if(localStorage[c]){if(l=JSON.parse(localStorage[c]),Array.isArray(s))for(n=s.length;n--;)for(r=l.length,e=s[n].id;r--;)l[r].id===e&&l.splice(r,1);else for(n=l.length,e=s.id;n--;)l[n].id===e&&l.splice(n,1);try{localStorage[c]=JSON.stringify(l),d.success=!0,t.setStatus(i.Status.SUCCESS).setResponse(d)}catch(a){d.success=!1,d.error=a,t.setStatus(i.Status.FAIL).setResponse(d)}return u(o,t),o}d.success=!1,d.error=Error("Not found"),t.setStatus(i.Status.FAIL).setResponse(d),u(o,t)},setTimeout(a,0),o}}),t.yamvc=n,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.proxy=t.yamvc.data.proxy||{},t.yamvc.data.proxy.Localstorage=e}(window),function(t){"use strict";var e,n=t.yamvc||{},r=0;e=n.Core.$extend({defaults:{idProperty:"id",proxy:null},init:function(t){n.Core.prototype.init.apply(this,arguments);var e,r=this;t=t||{},e=n.$merge(r._config,t.config),r.set("initOpts",t),r.set("config",e),r.set("isDirty",!0),r.initConfig(),r.initData()},initConfig:function(){var t=this,n=t._config;if(!n.namespace)throw Error("Model need to has namespace");return n.data||(n.data={}),t.set("clientId",n.namespace+"-"+r++),e.Parent.initConfig.apply(this),t},initData:function(){var t=this;return t.set("data",t.getData()||{}),t},setDataProperty:function(t,e){var n=this,r=n._data,i=r[t];e!==i&&(r[t]=e,n.set("isDirty",!0),n.fireEvent("data"+t.charAt(0).toUpperCase()+t.slice(1)+"Change",n,e,i))},getDataProperty:function(t){return this.get("data")[t]},data:function(t){var e,n=this,r=arguments.length;if(r>1)this.setDataProperty.apply(this,arguments);else{if("object"!=typeof t)return this.getDataProperty.apply(this,arguments);for(e in t)t.hasOwnProperty(e)&&n.setDataProperty(e,t[e])}return n},clear:function(){var t,e=this,n=e.get("data");for(t in n)n.hasOwnProperty(t)&&e.data(t,null);e.set("data",{}),e.fireEvent("dataChange",e,n)},load:function(t){var e,r=this,i=r.get("data"),a=r.getIdProperty(),o=n.Promise.$deferred(),s=new n.data.Action,c={};if(t[a]===undefined&&i[a]===undefined)throw Error("You need to pass id to load model");return t[a]=i[a],c.namespace=r.getNamespace(),c.params=t,c.callback=function(){e=r.getProxy().getResponse(),"success"===r.getProxy().getStatus()?(r.set("isDirty",!1),r.set("data",e),o.resolve({scope:r,response:e,action:"read"}),r.fireEvent("loaded",r,e,"read")):(o.reject({scope:r,response:e,action:"read"}),r.fireEvent("error",r,e,"read"))},s.setOptions(c),r.getProxy().read(s),o.promise},save:function(){var t,e,r=this,i=r.get("data"),a=r.getIdProperty(),o=n.Promise.$deferred(),s=new n.data.Action,c=r.getProxy(),u={};return r.get("isProcessing")||!r.get("isDirty")?!1:(r.set("isProcessing",!0),u.namespace=r.getNamespace(),u.callback=function(i,a){t=a.getResponse(),r.set("isProcessing",!1),a.getStatus()===n.data.Action.Status.SUCCESS?(r.set("isDirty",!1),r.set("data",t.result),o.resolve({scope:r,action:a,type:e}),r.fireEvent("saved",r,a,e)):(o.reject({scope:r,action:a,type:e}),r.fireEvent("error",r,a,e))},s.setOptions(u).setData(i),i[a]===undefined?(e="create",c.create(s)):(e="update",c.update(s)),o.promise)},remove:function(){var t,e=this,r=e.get("data"),i=e.getIdProperty(),a=n.Promise.$deferred(),o=new n.data.Action,s=e.getProxy(),c={};if(r[i]===undefined)throw Error("Can not remove empty model");return c.namespace=e.getNamespace(),c.callback=function(r,i){t=i.getResponse(),i.getStatus()===n.data.Action.Status.SUCCESS?(e.set("isDirty",!1),e.set("data",{}),a.resolve({scope:e,action:i,type:"remove"}),e.fireEvent("removed",e,"remove")):(a.reject({scope:e,action:i,type:"remove"}),e.fireEvent("error",e,"remove"))},o.setOptions(c).setData(r),s.destroy(o),s.destroy(o),a.promise},hasId:function(){return!!this._data[this._config.idProperty]},setDirty:function(t){return this.set("isDirty",!!t),this},isDirty:function(){return this._isDirty}}),t.yamvc=n,t.yamvc.Model=e}(window),function(t){"use strict";var e,n,r,i=t.yamvc||{};n={PENDING:0,FULFILLED:1,REJECTED:2},e=function(t){var e,i,a=this;a._state=n.PENDING,a._queue=[],e=function(t){r(a,t)},i=function(t){a.transition(n.REJECTED,t)},t&&t(e,i)},e.prototype.transition=function(t,e){var r=this;return r._state==t||r._state!==n.PENDING||t!=n.FULFILLED&&t!=n.REJECTED||2>arguments.length?!1:(r._state=t,r._value=e,r.run(),undefined)},e.prototype.run=function(){var t,e,i,a=this;e=function(t){return t},i=function(t){throw t},a._state!=n.PENDING&&setTimeout(function(){for(;a._queue.length;){var o=a._queue.shift();try{t=(a._state==n.FULFILLED?o.fulfill||e:o.reject||i)(a._value)}catch(s){o.promise.transition(n.REJECTED,s);continue}r(o.promise,t)}},0)},e.prototype.then=function(t,n){var r=this,i=new e;return r._queue.push({fulfill:"function"==typeof t&&t,reject:"function"==typeof n&&n,promise:i}),r.run(),i},e.prototype.resolve=function(t,i){if(t===i)t.transition(n.REJECTED,new TypeError);else if(i&&i.constructor==e)i.state==n.PENDING?i.then(function(e){r(t,e)},function(e){t.transition(n.REJECTED,e)}):t.transition(i.state,i.value);else if("object"!=typeof i&&"function"!=typeof i||null===i)t.transition(n.FULFILLED,i);else{var a=!1;try{var o=i.then;"function"==typeof o?o.call(i,function(e){a||(r(t,e),a=!0)},function(e){a||(t.transition(n.REJECTED,e),a=!0)}):t.transition(n.FULFILLED,i)}catch(s){a||t.transition(n.REJECTED,s)}}},e.prototype.getState=function(){return this._state},r=e.prototype.resolve,e.State=n,e.$resolved=function(t){return new e(function(e){e(t)})},e.$rejected=function(t){return new e(function(e,n){n(t)})},e.$deferred=function(){var t,n;return{promise:new e(function(e,r){t=e,n=r}),resolve:t,reject:n}},i.Promise=e,t.yamvc=i}(window),function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.$extend({init:function(){this.set("routing",{}),this.bindEvents()},bindEvents:function(){return t.onhashchange=this.onHashChange.bind(this),this},onHashChange:function(){var e=this.get("routing"),n=t.location.hash.substr(1),r=n.split("/"),i=r.shift();if(e[i]){var a=[];if(e[i].params)for(var o=0,s=e[i].params.length;s>o;o++){var c=e[i].params[o],u=r[o],l=RegExp(c.substr(1,c.length-2));a.push(u.match(l).input)}e[i].callback.apply(null,a)}return this},restore:function(){return this.onHashChange(),this},when:function(t,e){var n=this.get("routing"),r=t.split("/"),i=r.shift();return n[i]={callback:e,params:r},this.set("routing",n),this}}),t.yamvc.Router=e}(window),function(t,e){"use strict";function n(t){for(var e={},n=t.split(","),r=0;n.length>r;r++)e[n[r]]=!0;return e}var r,i,a,o,s=t.yamvc||{},c=document.createElement("style"),u=0;o=n("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),c.innerHTML=".yamvc {display:inline;}",document.body.appendChild(c),r={views:{},i:0,add:function(t,e){this.views[t]=e,this.i++},get:function(t){return this.views[t]}},i={tpl:{},add:function(t,e){this.tpl[t]=e},get:function(t){return this.tpl[t]}},a=s.Core.$extend({defaults:{parent:null},init:function(t){s.Core.prototype.init.apply(this);var e,n,i=this;return t=t||{},e=s.$merge(i._config,t.config),e.id=n=e.id||"view-"+r.i,e.children=e.children||[],i.set("initOpts",t),i.set("config",e),i.initConfig(),r.add(n,i),i},initConfig:function(){return s.Core.prototype.initConfig.apply(this),this.initTemplate(),this.initModels(),this},initTemplate:function(){var t,e=this,n=e.get("config"),r=document.createElement("div");if(!n.tpl)throw Error(n.id+": no tpl set");if(n.tpl instanceof s.view.Template)r.innerHTML=n.tpl.getHtml().innerHTML;else if(i.get(n.tpl))r.innerHTML=i.get(n.tpl).innerHTML;else{if(t=document.getElementById(n.tpl),!t)throw Error("no tpl "+n.tpl+" found");i.add(n.tpl,t.parentNode.removeChild(t)),r.innerHTML=i.get(n.tpl).innerHTML}return e.set("tpl",r),e},initModels:function(){var t,e,n=this;if(!n.getModels)return n;t=n.getModels();for(e in t)t.hasOwnProperty(e)&&n.setModel(e,t[e]);return n},setModel:function(t,e){var n=this,r=n.getModels();return r[e.getNamespace()]=e,n.setModels(r),n},getModel:function(t){var e,n,r=this,i=r.getModels();for(n=i.length;n--;)if(i[n].getNamespace()===t){e=i[n];break}return e},render:function(){var t,n,r,i,a,s,c,l,d,f=this,h=f._tpl,p=f._config,g=p.renderTo,v=p.parent,y=p.parent,m=[],C=[],_=0,E=0,w=0,S=0,D=[];for(v?v=g&&v.queryEl(g)?v.queryEl(g):v._el:g&&(v=document.querySelector(g)),a=h.cloneNode(!0),s=document.createTreeWalker(a,NodeFilter.SHOW_ALL,null,!1),c=s.nextNode();c;){if(3===c.nodeType){if(t=c.data.match(/\{\{(.*?)\}\}/gi)){var b=c.nodeValue,O=document.createElement("span"),P="v-r-b-"+u++;for(_=0,S=t.length,C=[],O.setAttribute("id",P);S>_;)n=t[_++],r=n.substr(2,n.length-4).split("."),f.getModel(r[0])?(i=f.getModel(r[0]).data(r[1]),i===e&&(i="")):i="",b=b.replace(n,i),C.push(r);O.appendChild(document.createTextNode(b)),m.push({original:c.nodeValue,headers:C,type:3,pointer:O,oldDOM:c})}}else for(D=c.attributes,E=D.length;E--;)if(d=D.item(E),t=d.nodeValue&&d.nodeValue.match(/\{\{(.*?)\}\}/gi)){var A=d.nodeValue,x=o[d.nodeName];for(_=0,S=t.length,C=[],i=x?!0:"";S>_;)n=t[_++],r=n.substr(2,n.length-4).split("."),x?i=i&&f.getModel(r[0]).data(r[1]):(f.getModel(r[0])&&(i=f.getModel(r[0]).data(r[1])||""),d.nodeValue=d.nodeValue.replace(n,i)),C.push(r);x&&(i?c.setAttribute(d.nodeName,i):c.removeAttribute(d.nodeName)),m.push({original:A,headers:C,fillAttr:x||!1,type:2,attrName:d.nodeName,pointer:c})}c=s.nextNode()}for(;h.childNodes.length>w&&1!==h.childNodes.item(w).nodeType;)w++;return l=w>1?a.childNodes.item(w):a,l.setAttribute("yamvc-id",p.id),l.setAttribute("class","yamvc"),f.set("el",l),f.set("bindings",m),f.resolveBindings(),v&&(v.appendChild(l),y&&0>y.findChild(f.getId())&&y.getChildren().push(f),f.set("isInDOM",!0),f.reAppendChildren(),f.fireEvent("render",null,f)),l},resolveBindings:function(){var t,e,n,r,i,a,o=this,s=o._bindings,c=o._config.models,u=0,l=0;for(t=function(t){return function(){o.partialRender(t)}},l=s.length;l--;)for(i=s[l],n=i.headers,3===i.type&&(i.oldDOM.parentNode.replaceChild(i.pointer,i.oldDOM),delete i.oldDOM),u=n.length;u--;)e=c[n[u][0]],r=n[u][1],e&&(a=r.charAt(0).toUpperCase()+r.slice(1),e.addListener("data"+a+"Change",t(i)))},partialRender:function(t){for(var e,n=this,r=3===t.type,i=r?t.original:t.fillAttr?!0:t.original,a=t.headers,o=a.length;o--;)e=a[o],i=r||!t.fillAttr?i.replace("{{"+e.join(".")+"}}",n.getModel(e[0]).data(e[1])):i&&n.getModel(e[0]).data(e[1]);return r?t.pointer.textContent=i:t.fillAttr&&!i?t.pointer.removeAttribute(t.attrName):t.pointer.setAttribute(t.attrName,i),n},queryEl:function(t){return this.get("el").querySelector(t)},queryEls:function(t){return this.get("el").querySelectorAll(t)},addChild:function(t,e){var n=this;return t.appendTo(n,e),n.fireEvent("elementAdded",n,t),n},getChild:function(t){var e=this;return 0>e.findChild(t)?!1:e.findChild(t)},findChild:function(t){for(var e=this.getChildren(),n=e.length;n--&&e[n].getId()!==t;);return n},removeChild:function(t){for(var e,n=this.getChildren(),r=n.length;r--;)n[r].getId()===t&&(e=n[r].clear());return e||null},removeChildren:function(){for(var t=this.getChildren(),e=t.length,n=[];e--;)n.push(t[e].clear());return n},clear:function(){{var t=this,e=t.get("el");t.getParent()}return t.isInDOM()&&(e.parentNode.removeChild(e),t.set("isInDOM",!1)),t},isInDOM:function(){return this._isInDOM},appendTo:function(t,e){var n=this,r=n.get("config"),i=n.getId(),a=t.getChildren(),o=r.parent,s=e?t.get("el").querySelector(e):t.get("el");return e&&(r.renderTo=e),o?o&&o.getId()!==t.getId()&&o.findChild(i)>-1&&o.getChildren().splice(o.findChild(i),1):r.parent=t,!n.isInDOM()&&t.isInDOM()&&(n.get("el")?(s.appendChild(n.get("el")),n.set("isInDOM",!0),n.reAppendChildren(),n.fireEvent("render",null,n)):n.render()),a.push(n),r.parent=t,n},reAppendChildren:function(){for(var t=this.getChildren(),e=t.length;e--;)t[e].appendTo(this);return this},show:function(){var t,e=this;return e.isInDOM()?(t=e.get("el").style,t.display="block",e.set("visible",!0),e.fireEvent("show",e,t),e):e},hide:function(){var t,e=this;return e.isInDOM()?(t=e.get("el").style,t.display="none",e.set("visible",!1),e.fireEvent("hide",e,t),e):e},isVisible:function(){return this.get("visible")&&this.isInDOM()}}),s.ViewManager=r,t.yamvc=s,t.yamvc.View=a}(window),function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.$extend({init:function(t){var r,i=this;e.Parent.init.apply(this,arguments),t=t||{},r=n.$merge(i._config,t.config),i.set("initOpts",t),i.set("config",r),i.initConfig(),i.initTpl()},initConfig:function(){var t=this,n=t.get("config");if(e.Parent.initConfig.apply(this),!n.id)throw Error("yamvc.data.Template: Template need to have id");return t},initTpl:function(){var t=this,e=t.getTpl(),n=document.createElement("div");Array.isArray(e)&&(e=e.join("")),n.innerHTML=e,t.set("html",n)},getHtml:function(){return this._html}}),t.yamvc=n,t.yamvc.view=t.yamvc.view||{},t.yamvc.view.Template=e}(window);
//@ sourceMappingURL=YAMVC-v0.1.11.min.js.map